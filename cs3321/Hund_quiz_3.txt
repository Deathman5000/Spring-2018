
/* REXX */
/* THE DATASET C332114.DATA(FOOD) HAS RECORDS WITH
   COLUMNS 1 - 42 ITEM NAME, 43-48 UNIT PRICE, 49-52 QUANTITY
   AND 53 - 80 UNUSED. THE PROGRAM READS AND DISPLAY THE RECORDS.
   FOR THIS WE HAVE A JCL JOB THAT WILL READ THE DATA AND DISPLAY
   BACK THE DATA.
   YOUR WORK WILL BE TO DISPLAY EACH PRODUCT NAME
   AND ITS TOTAL PRICE AND A GRAND TOTAL LINE FOR SUM OF ALL PRICES.
*/
  INPUT. = 0  /* INITIALIZE A STEM */
  DO I = 1 TO 30 BY 1
     PULL INPUT.I   /* READ A RECORD FROM THE DATASET SPECIFIED IN JCL */
  END
  INPUT.0 = 30

  /* SOME VARIABLES WE WILL BE USING */




NARRAY.0 = 0
PARRAY.0 = 0
QARRAY.0 = 0
TOTALORDER = 0
NCOMBINED.0 = 0
PCOMBINED.0 = 0
TARRAY.0 = 0
FDTOTAL.0 = 0
INDEX = 0

/* NEXT COMMAND WILL READ TILL END OF FILE ITS
   CONTENT RECORD BY RECORD
   INTO THE ARRAY INPUT.I, I= 1,2,3,...
   INPUT.0 WILL STORE THE NUMBER OF LINES(RECORDS)READ. FINIS
   MEANS AT THE END CLOSE THE FILE  */
/* NEXT COMMAND IN THE IF STATEMENT WILL READ TILL END OF FILE
   (* MEANS READ TILL EOF) ITS
   CONTENT RECORD BY RECORD
   INTO THE ARRAY OR STEM CALLED INPUT.I, I= 1,2,3,...
   INPUT.0 WILL STORE THE NUMBER OF LINES( OR RECORDS) READ, FINIS
   MEANS AT THE END CLOSE THE FILE  */

/* IF ALLOCATE IS SUCCESS, RC = 0 */

DO I = 1 TO INPUT.0
   ST = INPUT.I
   NARRAY.I = SUBSTR(ST,1,42)
   PARRAY.I = SUBSTR(ST,44,5)
   QARRAY.I = SUBSTR(ST,50,3)
   INDEX = INDEX + 1

END I
NARRAY.0 = INDEX
PARRAY.0 = INDEX
QARRAY.0 = INDEX

DO I = 1 TO NARRAY.0
   TOTALORDER = 0
   DO J = 1 TO NARRAY.0
      IF NARRAY.I = NARRAY.J THEN DO
         TOTALORDER = TOTALORDER + QARRAY.J
         PRICE = PARRAY.I
      END
   END
   NCOMBINED.I = NARRAY.I
   PCOMBINED.I = PARRAY.I
   TARRAY.I = TOTALORDER
   FDTOTAL.I = TARRAY.I * PCOMBINED.I
END


DO I = 1 TO NARRAY.0
   DO J = I + 1 TO NARRAY.0
      IF NCOMBINED.I = NCOMBINED.J THEN DO
         NCOMBINED.J = 0
         PCOMBINED.J = 0
         TARRAY.J = 0
         FDTOTAL.J = 0
      END
   END
END
NCOMBINED.0 = NARRAY.0
TOTAL = 0
DO I = 1 TO NCOMBINED.0
   IF PCOMBINED.I /= 0 THEN DO
      SAY NCOMBINED.I PCOMBINED.I FDTOTAL.I
      TOTAL = TOTAL + FDTOTAL.I
   END
END
SAY ' '
SAY 'THE GRAND TOTAL PROFIT IS' TOTAL
EXIT

